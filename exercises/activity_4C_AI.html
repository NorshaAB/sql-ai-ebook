<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Activity 4C - AI SQL Checker</title>
  <style>
    /* Add to your existing CSS */
    .feedback-card {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #3498db;
    }
    .grade {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .grade-A { color: #2ecc71; }
    .grade-B { color: #27ae60; }
    .grade-C { color: #f39c12; }
    .grade-D { color: #e67e22; }
    .grade-F { color: #e74c3c; }
    .feedback-list {
      padding-left: 20px;
    }
    .feedback-list li {
      margin-bottom: 8px;
      list-style-type: none;
      position: relative;
      padding-left: 25px;
    }
    .feedback-list li:before {
      content: "";
      position: absolute;
      left: 0;
      top: 6px;
      width: 16px;
      height: 16px;
      background-size: contain;
    }
    .correct:before {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232ecc71'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
    }
    .warning:before {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23f39c12'%3E%3Cpath d='M12 2L1 21h22L12 2zm0 3.5L18.5 19H5.5L12 5.5z'/%3E%3Cpath d='M12 16c.8 0 1.5-.7 1.5-1.5S12.8 13 12 13s-1.5.7-1.5 1.5.7 1.5 1.5 1.5zm-1-5h2v-4h-2v4z'/%3E%3C/svg%3E");
    }
    .error:before {
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23e74c3c'%3E%3Cpath d='M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zm4.2 14.2l-1.4 1.4L12 13.4l-2.8 2.8-1.4-1.4 2.8-2.8-2.8-2.8 1.4-1.4 2.8 2.8 2.8-2.8 1.4 1.4-2.8 2.8 2.8 2.8z'/%3E%3C/svg%3E");
    }
    .suggestion {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>SweetHome Database Design</h1>
  <h2>Activity 4C: CREATE TABLE Statements</h2>
  
  <!-- Branch Table -->
  <div class="table-card">
    <div class="table-header">a. Branch (<span class="sql-keyword">branchNo</span>, street, city, postcode)</div>
    <textarea id="sqlBranch" placeholder="CREATE TABLE Branch (
  branchNo VARCHAR(5) PRIMARY KEY,
  street VARCHAR(100) NOT NULL,
  city VARCHAR(50) NOT NULL,
  postcode VARCHAR(10) NOT NULL
);"></textarea>
    <button onclick="checkSQL('sqlBranch', 'feedbackBranch')">Check Branch</button>
    <button class="solution-btn" onclick="showSolution('branch')">Show Solution</button>
    <div id="feedbackBranch" class="feedback"></div>
  </div>

  <!-- Staff Table -->
  <div class="table-card">
    <div class="table-header">b. Staff (<span class="sql-keyword">staffNo</span>, fName, lName, position, gender, DOB, salary, <span class="sql-keyword">branchNo</span>)</div>
    <textarea id="sqlStaff" placeholder="CREATE TABLE Staff (
  staffNo VARCHAR(5) PRIMARY KEY,
  fName VARCHAR(50) NOT NULL,
  lName VARCHAR(50) NOT NULL,
  /* ... */
);"></textarea>
    <button onclick="checkSQL('sqlStaff', 'feedbackStaff')">Check Staff</button>
    <button class="solution-btn" onclick="showSolution('staff')">Show Solution</button>
    <div id="feedbackStaff" class="feedback"></div>
  </div>

  <!-- PropertyForRent Table -->
  <div class="table-card">
    <div class="table-header">c. PropertyForRent (<span class="sql-keyword">propertyNo</span>, type, rooms, rent, <span class="sql-keyword">ownerNo</span>, <span class="sql-keyword">staffNo</span>, <span class="sql-keyword">branchNo</span>)</div>
    <textarea id="sqlProperty" placeholder="CREATE TABLE PropertyForRent (
  propertyNo VARCHAR(5) PRIMARY KEY,
  /* ... */
);"></textarea>
    <button onclick="checkSQL('sqlProperty', 'feedbackProperty')">Check Property</button>
    <button class="solution-btn" onclick="showSolution('property')">Show Solution</button>
    <div id="feedbackProperty" class="feedback"></div>
  </div>

  <!-- Client Table -->
  <div class="table-card">
    <div class="table-header">d. Client (<span class="sql-keyword">clientNo</span>, fName, lName, telNo, prefType, maxRent, email)</div>
    <textarea id="sqlClient" placeholder="CREATE TABLE Client (
  clientNo VARCHAR(5) PRIMARY KEY,
  /* ... */
);"></textarea>
    <button onclick="checkSQL('sqlClient', 'feedbackClient')">Check Client</button>
    <button class="solution-btn" onclick="showSolution('client')">Show Solution</button>
    <div id="feedbackClient" class="feedback"></div>
  </div>

  <!-- PrivateOwner Table -->
  <div class="table-card">
    <div class="table-header">e. PrivateOwner (<span class="sql-keyword">ownerNo</span>, fName, lName, address, telNo, email, password)</div>
    <textarea id="sqlOwner" placeholder="CREATE TABLE PrivateOwner (
  ownerNo VARCHAR(5) PRIMARY KEY,
  /* ... */
);"></textarea>
    <button onclick="checkSQL('sqlOwner', 'feedbackOwner')">Check Owner</button>
    <button class="solution-btn" onclick="showSolution('owner')">Show Solution</button>
    <div id="feedbackOwner" class="feedback"></div>
  </div>

  <!-- Viewing Table -->
  <div class="table-card">
    <div class="table-header">f. Viewing (<span class="sql-keyword">clientNo</span>, <span class="sql-keyword">propertyNo</span>, viewDate, comments)</div>
    <textarea id="sqlViewing" placeholder="CREATE TABLE Viewing (
  /* Composite key? Foreign keys? */
);"></textarea>
    <button onclick="checkSQL('sqlViewing', 'feedbackViewing')">Check Viewing</button>
    <button class="solution-btn" onclick="showSolution('viewing')">Show Solution</button>
    <div id="feedbackViewing" class="feedback"></div>
  </div>
  <script>
    async function checkSQL(textareaId, feedbackId) {
      const sql = document.getElementById(textareaId).value.trim();
      const feedbackBox = document.getElementById(feedbackId);
      
      if (!sql) {
        feedbackBox.innerHTML = "<div class='feedback-card error'>‚ùå Please enter SQL first</div>";
        return;
      }

      feedbackBox.innerHTML = "<div class='loading'>‚è≥ Analyzing with AI...</div>";
      
      try {
        const response = await fetch("https://openrouter-proxy-k2ca.onrender.com/ai", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt: `Analyze this SQL CREATE TABLE statement in MAX 5 bullet points. For each point use EMOJI + 1 sentence. End with letter grade (A-F). Format exactly like this example:

‚úÖ Primary key correctly defined
‚ö†Ô∏è Missing foreign key to staff table
‚ùå Phone number should be VARCHAR(15)
‚úÖ Good NOT NULL constraints
üí° Add branch_manager column

Grade: B

Here's the SQL to analyze:
${sql}`
          })
        });

        const data = await response.json();
        let aiResponse = data.choices?.[0]?.message?.content || data.message || data;
        
        // Format the response
        const gradeMatch = aiResponse.match(/Grade: ([A-F])/i);
        const grade = gradeMatch ? gradeMatch[1] : '?';
        
        feedbackBox.innerHTML = `
          <div class="feedback-card">
            <div class="grade grade-${grade}">Grade: ${grade}</div>
            <ul class="feedback-list">
              ${aiResponse.replace(/Grade: [A-F]/i, '')
                         .split('\n')
                         .filter(line => line.trim())
                         .map(line => {
                           if (line.includes('‚úÖ')) return `<li class="correct">${line}</li>`;
                           if (line.includes('‚ö†Ô∏è')) return `<li class="warning">${line}</li>`;
                           if (line.includes('‚ùå')) return `<li class="error">${line}</li>`;
                           if (line.includes('üí°')) return `<li class="suggestion">${line}</li>`;
                           return `<li>${line}</li>`;
                         })
                         .join('')}
            </ul>
          </div>`;
      } catch (error) {
        feedbackBox.innerHTML = `<div class="feedback-card error">‚ùå Error: ${error.message || "Failed to get AI response"}</div>`;
      }
    }
  </script>
</body>
</html>
