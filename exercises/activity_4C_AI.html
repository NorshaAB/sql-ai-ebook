<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Activity 4C - SQL Table Creation</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; line-height: 1.6; }
    textarea {
      width: 100%; height: 160px; font-family: monospace;
      border: 1px solid #ccc; padding: 10px; box-sizing: border-box;
    }
    .feedback, .hint {
      background: #f9f9f9; padding: 10px;
      border-left: 4px solid #007BFF; margin-top: 10px; white-space: pre-wrap;
    }
    button {
      padding: 6px 12px; margin: 5px 5px 5px 0;
      border: none; cursor: pointer; font-size: 14px;
      background-color: #007BFF; color: white; border-radius: 4px;
    }
    button:hover {
      background-color: #0056b3;
    }
    .row { display: flex; gap: 10px; margin-bottom: 5px; }
    h3 { margin-top: 40px; }
    .section-block {
      border: 1px solid #ddd; padding: 15px; margin-bottom: 25px;
      border-radius: 5px; background-color: #fcfcfc;
    }
    .icon { font-weight: bold; }
    .tick { color: green; }
    .info { color: #007BFF; }
    .error { color: red; }
    details summary {
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>

<h2>Activity 4C: Create Tables for SweetHome Database</h2>
<p><strong>Instructions:</strong> Write <code>CREATE TABLE</code> SQL statements for each of the six tables. Include <strong>PRIMARY KEY</strong> and <strong>FOREIGN KEY</strong> constraints where applicable.</p>
<p>a. Branch (branchNo, street, city, postcode);</p>
<p>b. Staff (staffNo, fName, lName, position, gender, DOB, salary, branchNo);</p>
<p>c. PropertyForRent (propertyNo, type, rooms, rent, ownerNo, staffNo, branchNo);</p>
<p>d. Client (clientNo, fName, lName, telNo, prefType, maxRent, email);</p>
<p>e. PrivateOwner (ownerNo, fName, lName, address, telNo, email, password);</p>
<p>f. Viewing (clientNo, propertyNo, viewDate, comments);</p>
<hr>

<script>
const tables = [
  {
    name: "Branch ",
    id: "branch",
    hint: "Use branchNo as PRIMARY KEY. Include street, city, postcode as VARCHAR fields."
  },
  {
    name: "Staff",
    id: "staff",
    hint: "Use staffNo as PRIMARY KEY. Include foreign key branchNo referencing Branch(branchNo)."
  },
  {
    name: "PropertyForRent",
    id: "property",
    hint: "Use propertyNo as PRIMARY KEY. Use foreign keys: ownerNo, staffNo, branchNo."
  },
  {
    name: "Client",
    id: "client",
    hint: "Use clientNo as PRIMARY KEY. No foreign keys needed."
  },
  {
    name: "PrivateOwner",
    id: "owner",
    hint: "Use ownerNo as PRIMARY KEY. Include personal contact details."
  },
  {
    name: "Viewing",
    id: "viewing",
    hint: "Composite PRIMARY KEY (clientNo, propertyNo, viewDate). Foreign keys to Client and PropertyForRent."
  }
];

function generateSection(table) {
  return `
<div class="section-block">
  <h3>${table.name} Table</h3>
  <textarea id="${table.id}" placeholder="Write your CREATE TABLE statement for ${table.name}..."></textarea>
  <div class="row">
    <button onclick="check('${table.id}', '${table.name}')">Check Answer</button>
    <button onclick="toggleDetails('hint_${table.id}')">üí° Hint</button>
  </div>
  <div class="feedback" id="feedback_${table.id}"></div>
  <details id="hint_${table.id}" style="display:none;"><summary>Hint</summary><div class="hint">${table.hint}</div></details>
</div>
`;
}

function check(id, name) {
  const answer = document.getElementById(id).value.trim().toLowerCase();
  let fb = "";

  // Check for CREATE TABLE
  const createTableRegex = /create\s+table\s+\w+\s*\([\s\S]*\)/;
  if (createTableRegex.test(answer)) {
    fb += `‚úÖ <span class="tick">Your answer includes a CREATE TABLE statement.</span>\n`;
  } else {
    fb += `‚ùå <span class="error">Missing or malformed CREATE TABLE syntax.</span>\n`;
  }

  // Check for PRIMARY KEY inside parentheses
  const pkRegexInline = /[\s\S]*\([\s\S]*primary\s+key\s*\(\s*\w+(\s*,\s*\w+)*\s*\)[\s\S]*\)/;
  if (pkRegexInline.test(answer)) {
    fb += `‚úÖ <span class="tick">Primary key correctly declared.</span>\n`;
  } else {
    fb += `‚ùå <span class="error">Primary key is missing or incorrectly formatted.</span>\n`;
  }

  // Check for FOREIGN KEY declaration (not mandatory)
  const fkRegex = /foreign\s+key\s*\(\s*\w+\s*\)\s+references\s+\w+\s*\(\s*\w+\s*\)/;
  if (fkRegex.test(answer)) {
    fb += `‚úÖ <span class="tick">Foreign key correctly declared.</span>\n`;
  } else {
    fb += `‚ÑπÔ∏è <span class="info">If applicable, add FOREIGN KEY constraints.</span>\n`;
  }

  document.getElementById(`feedback_${id}`).innerHTML = fb;
}

function toggleDetails(id) {
  const el = document.getElementById(id);
  el.style.display = el.style.display === "none" ? "block" : "none";
}
</script>

<div id="exerciseContainer">
  <script>
    document.getElementById("exerciseContainer").innerHTML = tables.map(generateSection).join('');
  </script>
</div>

</body>
</html>
